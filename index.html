<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SSL Certificate Dashboard</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Segoe UI; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
.container { max-width: 1200px; margin: 0 auto; }
header { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 30px; }
header h1 { color: #333; margin-bottom: 10px; }
.controls { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
.btn-success { background: #28a745; color: white; }
.btn-primary { background: #667eea; color: white; }
.btn-danger { background: #dc3545; color: white; }
.btn-primary:hover { background: #5568d3; }
.btn-danger:hover { background: #c82333; }
.btn-success:hover { background: #218838; }
.add-website-section { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 30px; }
.input-group { display: flex; gap: 10px; }
input { flex: 1; min-width: 250px; padding: 10px 15px; border: 1px solid #ddd; border-radius: 5px; }
input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 5px rgba(102,126,234,0.3); }
.dashboard { background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); overflow: hidden; }
.table-header { padding: 20px; border-bottom: 2px solid #f0f0f0; }
table { width: 100%; border-collapse: collapse; }
thead { background: #f8f9fa; border-bottom: 2px solid #ddd; }
th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
th { color: #333; font-weight: bold; text-transform: uppercase; }
tbody tr:hover { background: #f8f9fa; }
.status-valid { background: #d4edda; color: #155724; padding: 5px 10px; border-radius: 5px; }
.status-warning { background: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 5px; }
.status-critical { background: #f8d7da; color: #721c24; padding: 5px 10px; border-radius: 5px; }
.status-expired { background: #f5c6cb; color: #721c24; padding: 5px 10px; border-radius: 5px; }
.actions { display: flex; gap: 5px; }
.btn-small { padding: 5px 10px; font-size: 12px; }
.empty-state { text-align: center; padding: 50px; color: #999; }
.toast { position: fixed; top: 20px; right: 20px; padding: 15px 20px; background: white; border-radius: 5px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 1000; animation: slideIn 0.3s ease; }
.toast.success { border-left: 4px solid #28a745; }
.toast.error { border-left: 4px solid #dc3545; }
@keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
.stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
.stat-card.warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.stat-card.critical { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
.stat-card.expired { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; }
.stat-number { font-size: 32px; font-weight: bold; }
.stat-label { font-size: 12px; text-transform: uppercase; opacity: 0.9; }
</style>
</head>
<body>
<div class="container">
<header>
<h1> SSL Certificate Expiry Tracker</h1>
<div style="display: flex; gap: 30px; margin-top: 15px; font-size: 14px; color: #666;">
<div> Total Websites: <strong id="totalWebsites">0</strong></div>
<div> Last Updated: <strong id="lastUpdated">Never</strong></div>
</div>
<div class="controls">
<button class="btn-success" onclick="checkAll()"> Check All Now</button>
<button class="btn-primary" onclick="exportData()"> Export Data</button>
<button class="btn-danger" onclick="logout()"> Logout</button>
</div>
</header>
<div class="add-website-section">
<h2>Add Website</h2>
<div class="input-group">
<input type="text" id="urlInput" placeholder="Enter website URL" onkeypress="handleKeyPress(event)">
<button class="btn-primary" onclick="addWebsite()">Add Website</button>
</div>
</div>
<div class="dashboard">
<div class="table-header">
<h2>Monitored Websites</h2>
<div id="statsContainer" class="stats"></div>
</div>
<div style="background: #f0f4ff; padding: 20px; border-left: 4px solid #667eea; border-radius: 5px; margin-bottom: 25px;">
    <strong style="color: #333; display: block; margin-bottom: 12px;"> Certificate Status Legend</strong>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; font-size: 13px; color: #666;">
        <div><span class="status-valid"> VALID</span><br/><small>31+ days remaining</small></div>
        <div><span class="status-warning"> WARNING</span><br/><small>7-30 days remaining</small></div>
        <div><span class="status-critical"> CRITICAL</span><br/><small>1-6 days remaining</small></div>
        <div><span class="status-expired"> EXPIRED</span><br/><small>0 or fewer days</small></div>
    </div>
</div>
<table>
<thead>
<tr><th>Website URL</th><th>Expiry Date</th><th>Days</th><th>Status</th><th>Last Checked</th><th>Actions</th></tr>
</thead>
<tbody id="tableBody">
<tr><td colspan="6" class="empty-state">No websites added yet</td></tr>
</tbody>
</table>
</div>
</div>
<script>
const API_BASE = window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/')) + '/api.php';
async function loadData() {
  try {
    const response = await fetch(API_BASE + '/websites');
    if (response.status === 401) {
      window.location.href = 'login.php';
      return;
    }
    if (!response.ok) throw new Error('HTTP ' + response.status);
    const data = await response.json();
    displayData(data);
  } catch (error) {
    console.error('Error:', error);
    showToast('Cannot connect to server', 'error');
  }
}
function displayData(data) {
  document.getElementById('totalWebsites').textContent = data.websites.length;
  if (data.lastChecked) document.getElementById('lastUpdated').textContent = new Date(data.lastChecked).toLocaleString();
  const stats = { valid: 0, warning: 0, critical: 0, expired: 0 };
  data.websites.forEach(w => {
    if (w.status === 'Valid') stats.valid++;
    else if (w.status === 'Warning') stats.warning++;
    else if (w.status === 'Critical') stats.critical++;
    else if (w.status === 'Expired') stats.expired++;
  });
  document.getElementById('statsContainer').innerHTML = 
    '<div class="stat-card"><div class="stat-number">' + stats.valid + '</div><div class="stat-label">Valid</div></div>' +
    '<div class="stat-card warning"><div class="stat-number">' + stats.warning + '</div><div class="stat-label">Warning</div></div>' +
    '<div class="stat-card critical"><div class="stat-number">' + stats.critical + '</div><div class="stat-label">Critical</div></div>' +
    '<div class="stat-card expired"><div class="stat-number">' + stats.expired + '</div><div class="stat-label">Expired</div></div>';
  const tableBody = document.getElementById('tableBody');
  if (data.websites.length === 0) {
    tableBody.innerHTML = '<tr><td colspan="6" class="empty-state">No websites added yet</td></tr>';
    return;
  }
  tableBody.innerHTML = data.websites.map((w, i) => '<tr><td style="color:#667eea;font-weight:500">' + w.url + '</td><td>' + (w.expiryDate || '-') + '</td><td>' + (w.daysUntilExpiry || '-') + '</td><td><span class="status-' + w.status.toLowerCase() + '">' + w.status + '</span></td><td>' + (w.lastChecked ? new Date(w.lastChecked).toLocaleString() : '-') + '</td><td class="actions"><button class="btn-primary btn-small" onclick="checkSingle(' + i + ')">Check</button> <button class="btn-danger btn-small" onclick="deleteWebsite(' + i + ')">Delete</button></td></tr>').join('');
}
async function addWebsite() {
  const url = document.getElementById('urlInput').value.trim();
  if (!url || !url.includes('.')) { showToast('Enter valid URL', 'error'); return; }
  try {
    const response = await fetch(API_BASE + '/websites', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ url }) });
    if (response.ok) {
      document.getElementById('urlInput').value = '';
      showToast('Website added', 'success');
      setTimeout(() => loadData(), 500);
    }
  } catch (error) { showToast('Error: ' + error.message, 'error'); }
}
async function deleteWebsite(i) {
  if (!confirm('Delete?')) return;
  try {
    await fetch(API_BASE + '/websites/' + i, { method: 'DELETE' });
    showToast('Deleted', 'success');
    loadData();
  } catch (error) { showToast('Error', 'error'); }
}
async function checkSingle(i) {
  try {
    await fetch(API_BASE + '/check/' + i, { method: 'POST' });
    showToast('Checked', 'success');
    setTimeout(() => loadData(), 500);
  } catch (error) { showToast('Error', 'error'); }
}
async function checkAll() {
  try {
    await fetch(API_BASE + '/check-all', { method: 'POST' });
    showToast('Checking...', 'success');
    setTimeout(() => loadData(), 2000);
  } catch (error) { showToast('Error', 'error'); }
}
function exportData() {
  fetch(API_BASE + '/websites').then(r => r.json()).then(data => {
    const csv = 'Website,Expiry,Days,Status,Checked\n' + data.websites.map(w => '"' + w.url + '","' + (w.expiryDate || '') + '","' + (w.daysUntilExpiry || '') + '","' + w.status + '","' + (w.lastChecked || '') + '"').join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ssl-' + new Date().toISOString().split('T')[0] + '.csv';
    a.click();
    window.URL.revokeObjectURL(url);
    showToast('Exported', 'success');
  });
}
function logout() { window.location.href = 'logout.php'; }
function handleKeyPress(e) { if (e.key === 'Enter') addWebsite(); }
function showToast(msg, type) {
  const t = document.createElement('div');
  t.className = 'toast ' + type;
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 3000);
}
setInterval(loadData, 30000);
loadData();
</script>
</body>
</html>